# Builds docs and pushes them to the docs repo (pushing only on master).
name: Build, test and publish

on:
  push:
    branches: [ master ]
  pull_request: {}

jobs:
  build:
    runs-on: ubuntu-latest
    name: Build the Docs
    steps:
      - name: Checkout "riptide-repo"
        uses: actions/checkout@v6
      - name: Checkout "riptide-docs"
        uses: actions/checkout@v6
        with:
          repository: theCapypara/riptide-docs
          path: docs
          token: ${{ secrets.PRIVATE_GITHUB_TOKEN }}
      - name: Set up Python 3.12
        uses: actions/setup-python@v6
        with:
          python-version: 3.12
      - name: Remove old docs
        run: rm -rf ./docs/source/repo_docs
      - name: Build docs
        run: ./copy_docs.py ./docs/source/repo_docs
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        if: github.ref == 'refs/heads/master'
        with:
          title: Update repo docs
          body: Autogenerated by ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          commit-message: Riptide Repo documentation - Build for ${{ github.sha }}
          path: docs
          token: ${{ secrets.PRIVATE_GITHUB_TOKEN }}
          branch: update-docs
          delete-branch: true
          sign-commits: true
